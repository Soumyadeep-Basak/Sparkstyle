# Virtual Try-On Feature Documentation

## Overview
The Virtual Try-On feature allows users to scan QR codes of products and see how they would look wearing those items using AI-powered virtual try-on technology.

## How it Works

### Backend Flow
1. **QR Code Scanning**: User scans a QR code containing a product ID
2. **Product Retrieval**: Frontend fetches product details from `/api/products/{product_id}`
3. **User Image Lookup**: Backend finds the user's stored front-facing body image
4. **Product Image Access**: Backend accesses the product's garment image from uploads
5. **AI Try-On Processing**: Backend calls the try-on AI service to merge user + garment
6. **Result Return**: Base64-encoded result image is returned to frontend

### Frontend Flow
1. **Camera Permission**: Request camera access for QR scanning
2. **QR Scanner**: Use expo-camera to scan QR codes
3. **Product Display**: Show product details and image
4. **Try-On Trigger**: User taps "Try On This Product"
5. **Result Display**: Show the AI-generated try-on result

## API Endpoints

### Get Product by ID
```
GET /api/products/{product_id}
```
Returns product details including name, price, description, and image filename.

### Try-On with Product
```
POST /api/tryon/product
Body: FormData
- user_id: integer
- product_id: integer
```
Returns JSON with base64-encoded try-on result image.

### Upload Access
```
GET /api/uploads/{filename}
```
Serves uploaded product images.

## Frontend Components

### TryOn Screen (`/app/(tabs)/tryon.tsx`)
- QR code scanner using expo-camera
- Product details display
- Try-on processing and result display
- Error handling and loading states

## Dependencies

### Frontend
- `expo-camera`: QR code scanning
- `expo-barcode-scanner`: Barcode detection
- React Native Image component for displaying results

### Backend  
- FastAPI for API endpoints
- SQLAlchemy for database access
- Base64 encoding for image transport
- Subprocess calls to try-on AI service

## Setup Instructions

### 1. Backend Setup
```bash
cd backend
pip install -r requirements.txt
python main.py  # Start the FastAPI server
```

### 2. Create Test Data
```bash
cd backend
python create_test_data.py  # Creates test products and user
```

### 3. Frontend Setup
```bash
cd frontend
npm install
npm start
```

### 4. QR Code Generation
1. Go to any QR code generator (e.g., qr-code-generator.com)
2. Use the product IDs generated by the test data script
3. Generate QR codes containing just the product ID number
4. Print or display QR codes for scanning

## Testing the Feature

1. **Start the backend server**
2. **Run the test data script** to create sample products
3. **Generate QR codes** using the product IDs
4. **Open the frontend app** and navigate to the "Try On" tab
5. **Allow camera permissions** when prompted
6. **Scan a QR code** containing a product ID
7. **View product details** and tap "Try On This Product"
8. **Wait for processing** and view the result

## Troubleshooting

### Common Issues

**QR Code Not Recognized**
- Ensure QR code contains only the numeric product ID
- Check camera permissions are granted
- Ensure good lighting when scanning

**Product Not Found**
- Verify the product ID exists in the database
- Check that test data was created successfully
- Ensure backend server is running

**Try-On Failed**
- Check that user has uploaded body measurement images
- Verify product has an associated image
- Check backend logs for subprocess errors
- Ensure try-on AI service is properly configured

**Image Not Displaying**
- Check network connectivity
- Verify uploads endpoint is accessible
- Ensure proper CORS configuration

### Required User Data
For try-on to work, users need:
- A front-facing body image (stored via body measurement API)
- Valid user ID in the database

### Environment Variables
Ensure these are set in your environment:
- Database connection settings (POSTGRES_*)
- API_KEY for try-on service (if using external service)

## File Structure
```
frontend/app/(tabs)/
├── tryon.tsx          # Main try-on screen
├── _layout.tsx        # Tab navigation (includes try-on tab)
└── qr-scan.tsx        # Standalone QR scanner (reference)

backend/api/
├── tryon.py           # Try-on API endpoints
├── products.py        # Product management
├── uploads.py         # File serving
└── users.py           # User management

backend/
├── create_test_data.py # Test data generation
└── tryon/main.py      # AI try-on service
```
